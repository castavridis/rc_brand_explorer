# Data Model: Vercel Deployment Support

**Feature**: Vercel Deployment Support
**Date**: 2025-11-13
**Phase**: Phase 1 - Data Model Design

## Overview

This feature does not introduce traditional data entities (models, database records). Instead, it defines **configuration entities** that control deployment behavior. This document captures the structure of deployment configuration and build artifacts.

## Configuration Entities

### 1. Vercel Configuration (vercel.json)

**Purpose**: Define deployment behavior, routing rules, and build settings for Vercel platform.

**Location**: `vercel.json` (repository root)

**Schema**: See `contracts/vercel-config-schema.json` for JSON Schema definition

**Fields**:

| Field | Type | Required | Description | Validation Rules |
|-------|------|----------|-------------|------------------|
| `rewrites` | Array<Rewrite> | No | URL rewrite rules for SPA routing | Each rewrite must have `source` and `destination` |
| `redirects` | Array<Redirect> | No | HTTP redirects (301/302) | Each redirect must have `source`, `destination`, `permanent` |
| `headers` | Array<Header> | No | Custom HTTP headers for responses | Each header must have `source` and `headers` array |
| `buildCommand` | String | No | Custom build command (overrides framework detection) | Must be valid shell command |
| `outputDirectory` | String | No | Build output directory (overrides framework detection) | Must be valid path relative to root |
| `framework` | String | No | Framework preset (e.g., "vite") | Must be supported framework name |
| `env` | Object | No | Environment variables for builds | Key-value pairs, values are strings |

**Relationships**:
- **Depends on**: `package.json` (build scripts), `vite.config.ts` (build configuration)
- **Used by**: Vercel platform during deployment

**State Transitions**: N/A (configuration is static)

**Example**:
```json
{
  "rewrites": [
    { "source": "/(.*)", "destination": "/index.html" }
  ]
}
```

### 2. Build Artifact (dist/ directory)

**Purpose**: Production-ready static files generated by Vite build process, served by Vercel.

**Location**: `dist/` (generated, not committed to Git)

**Structure**:
```text
dist/
├── index.html              # Entry HTML file (served for all routes)
├── assets/                 # Bundled JS/CSS with content hashes
│   ├── index-[hash].js     # Main application bundle
│   ├── index-[hash].css    # Extracted CSS
│   └── ...                 # Additional chunks
├── assets/logos/           # Copied from source
│   ├── nike.svg
│   ├── apple.svg
│   └── ...
└── data/brands/            # Copied from source
    ├── brands.json
    └── schema.json
```

**Validation Rules**:
- `index.html` MUST exist at root
- All asset references in HTML must resolve to files in `dist/`
- Logo paths MUST match paths in `brands.json`

**Relationships**:
- **Generated by**: Vite build process (`npm run build`)
- **Consumed by**: Vercel Edge Network (served as static files)

### 3. Deployment Record (Vercel Platform)

**Purpose**: Metadata about each deployment created by Vercel (stored on Vercel platform, not in repository).

**Location**: Vercel Dashboard and API

**Fields** (read-only, managed by Vercel):

| Field | Type | Description |
|-------|------|-------------|
| `id` | String | Unique deployment identifier |
| `url` | String | Deployment URL (e.g., `brand-explorer-abc123.vercel.app`) |
| `state` | Enum | Deployment state: `BUILDING`, `READY`, `ERROR`, `CANCELED` |
| `createdAt` | Timestamp | When deployment was triggered |
| `buildDuration` | Number | Build time in milliseconds |
| `source` | String | Git branch or commit that triggered deployment |
| `creator` | Object | User or bot that initiated deployment |

**State Transitions**:
```text
QUEUED → BUILDING → READY (success)
                 → ERROR (build failed)
                 → CANCELED (manually stopped)
```

**Relationships**:
- **Triggered by**: Git push events (via GitHub integration)
- **References**: Git commit SHA, branch name
- **Produces**: Deployed URL, build logs

## Asset Data Flow

```text
[Source Code]
    ↓
[Git Push to GitHub]
    ↓
[Vercel Detects Push] → Reads vercel.json configuration
    ↓
[Runs Build Command] → Executes `npm run build`
    ↓
[Build Output (dist/)] → Contains bundled code + static assets
    ↓
[Upload to Edge Network] → Deploys to global CDN
    ↓
[Deployment URL Ready] → User can access application
```

## Validation Rules

### Build Output Validation

1. **Structure Validation**:
   - `dist/index.html` must exist
   - All asset paths referenced in `index.html` must resolve to files in `dist/`
   - Logo images must exist at paths specified in `brands.json`

2. **Size Constraints**:
   - Total deployment size < 100MB (Vercel limit)
   - Individual file size < 50MB (Vercel limit)
   - Current assets (~10MB total) well under limits

3. **Content Validation**:
   - `index.html` must include `<div id="root"></div>` for React mounting
   - JavaScript bundles must not contain syntax errors
   - JSON files must be valid JSON

### Configuration Validation

1. **vercel.json Schema**:
   - Must be valid JSON (no syntax errors)
   - Must conform to Vercel configuration schema
   - Rewrite rules must not create infinite loops

2. **Build Script Validation**:
   - `package.json` must have `build` script defined
   - Build command must exit with code 0 (success)
   - Build must produce output in expected directory (`dist/`)

## Integration Points

### With Existing Application

- **Zero Code Changes**: Application code remains unchanged
- **Asset Paths**: Vite handles asset path resolution automatically
- **Routing**: Client-side routing (if added) works via vercel.json rewrites

### With Vercel Platform

- **Git Integration**: Vercel connects to GitHub repository
- **Build System**: Vercel runs `npm install && npm run build` automatically
- **CDN Deployment**: Build artifacts uploaded to Edge Network
- **SSL Provisioning**: HTTPS certificates generated automatically

## Assumptions

1. **Build Determinism**: `npm run build` produces consistent output for same source code
2. **Asset Availability**: All logos and data files are committed to Git repository
3. **No Backend**: Application is fully static, no server-side code needed
4. **Browser Compatibility**: Build output targets modern browsers (ES2020+)

## Future Extensions

**Not in Scope for Initial Implementation**:

- Environment-specific builds (staging vs. production)
- Server-side rendering or API routes
- Incremental static regeneration
- Edge middleware or functions
- Advanced caching strategies

These can be added later if requirements change, but MVP deployment requires only static file serving.
